/dts-v1/;
/plugin/;

/*
 * Rock 5 C  –  CPU fan on PWM3-CH0 (header fan connector)
 * Polarity 0  (HIGH = on).  Period 40 000 ns  (25 kHz)
 */

/* ---------- enable PWM3 controller & pinmux ---------- */
&pwm3 {
        status = "okay";
        pinctrl-names = "default";
        pinctrl-0     = <&pwm3m1_pins>;   /* GPIO1_D0 = fan header */
};

/* ---------- pwm-fan device (cooling-device) ---------- */
&{/} {
        fan0: cpu_fan {
                compatible     = "pwm-fan";
                /*  ctrl  ch  period(ns)  polarity */
                pwms           = <&pwm3 0 40000 0>;
                cooling-levels = <0 64 128 192 255>;
                #cooling-cells = <2>;
        };

        /* optional: single trip just to prove it builds */
        &soc_thermal {
                trips {
                        fan_trip0: fan_trip0 {
                                temperature = <55000>; /* 55 °C */
                                hysteresis   = <2000>;
                                type         = "active";
                        };
                };
                cooling-maps {
                        fan_map0 {
                                trip            = <&fan_trip0>;
                                cooling-device  = <&fan0 THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
                        };
                };
        };
};
